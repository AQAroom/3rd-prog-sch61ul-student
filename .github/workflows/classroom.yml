name: "BankAccount Tests"
on: [push]
permissions:
  checks: write
  actions: read
  contents: read

jobs:
  test-bank-account:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
      
      # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð±ÐµÐ· heredoc
      - name: Create simple test script
        run: |
          echo 'import ast, sys' > check.py
          echo 'try:' >> check.py
          echo '    with open("task.py", "r") as f:' >> check.py
          echo '        code = f.read()' >> check.py
          echo 'except FileNotFoundError:' >> check.py
          echo '    print("ERROR: Ð¤Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½")' >> check.py
          echo '    sys.exit(1)' >> check.py
          echo 'try:' >> check.py
          echo '    tree = ast.parse(code)' >> check.py
          echo 'except SyntaxError as e:' >> check.py
          echo '    print(f"ERROR: {e}")' >> check.py
          echo '    sys.exit(1)' >> check.py
          echo 'bank_class = None' >> check.py
          echo 'for node in ast.walk(tree):' >> check.py
          echo '    if isinstance(node, ast.ClassDef) and node.name == "BankAccount":' >> check.py
          echo '        bank_class = node' >> check.py
          echo '        break' >> check.py
          echo 'if not bank_class:' >> check.py
          echo '    print("ERROR: ÐšÐ»Ð°ÑÑ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½")' >> check.py
          echo '    sys.exit(1)' >> check.py
          echo 'methods = []' >> check.py
          echo 'for item in bank_class.body:' >> check.py
          echo '    if isinstance(item, ast.FunctionDef):' >> check.py
          echo '        methods.append(item.name)' >> check.py
          echo 'required = ["__init__", "add", "status", "withdraw"]' >> check.py
          echo 'for m in required:' >> check.py
          echo '    if m not in methods:' >> check.py
          echo '        print(f"ERROR: ÐÐµÑ‚ Ð¼ÐµÑ‚Ð¾Ð´Ð° {m}")' >> check.py
          echo '        sys.exit(1)' >> check.py
          echo 'print("SUCCESS: Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° OK")' >> check.py
      
      # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹
      - name: Check structure
        id: structure_test
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: "Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ»Ð°ÑÑÐ°"
          command: "python check.py"
          expected-output: "SUCCESS: Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° OK"
          comparison-method: contains
          timeout: 10
          max-score: 50
      
      # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð² Ð²Ð²Ð¾Ð´Ð°-Ð²Ñ‹Ð²Ð¾Ð´Ð°
      - name: Create IO test script
        run: |
          echo 'import sys' > test_io.py
          echo 'try:' >> test_io.py
          echo '    from task import BankAccount' >> test_io.py
          echo 'except ImportError:' >> test_io.py
          echo '    sys.exit(1)' >> test_io.py
          echo 'data = sys.stdin.read().strip().split()' >> test_io.py
          echo 'if len(data) != 2:' >> test_io.py
          echo '    sys.exit(1)' >> test_io.py
          echo 'try:' >> test_io.py
          echo '    b = int(data[0])' >> test_io.py
          echo '    op = int(data[1])' >> test_io.py
          echo '    acc = BankAccount("test", b)' >> test_io.py
          echo '    if op >= 0:' >> test_io.py
          echo '        acc.add(op)' >> test_io.py
          echo '    else:' >> test_io.py
          echo '        acc.withdraw(-op)' >> test_io.py
          echo '    acc.status()' >> test_io.py
          echo 'except:' >> test_io.py
          echo '    pass' >> test_io.py
      
      # Ð¢ÐµÑÑ‚ 1
      - name: Test 1 - Deposit
        id: test1
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: "ÐŸÐ¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ"
          command: "python test_io.py"
          input: "1000\n200"
          expected-output: "Ð‘Ð°Ð»Ð°Ð½Ñ ÑÑ‡Ñ‘Ñ‚Ð°: 1000 ÐµÐ´Ð¸Ð½Ð¸Ñ†\nÐÐ° ÑÑ‡ÐµÑ‚ Ð·Ð°Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¾: 200 ÐµÐ´Ð¸Ð½Ð¸Ñ†\nÐ‘Ð°Ð»Ð°Ð½Ñ ÑÑ‡Ñ‘Ñ‚Ð°: 1200 ÐµÐ´Ð¸Ð½Ð¸Ñ†"
          comparison-method: exact
          timeout: 5
          max-score: 17
      
      # Ð¢ÐµÑÑ‚ 2
      - name: Test 2 - Withdrawal
        id: test2
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: "Ð¡Ð½ÑÑ‚Ð¸Ðµ"
          command: "python test_io.py"
          input: "1000\n-300"
          expected-output: "Ð‘Ð°Ð»Ð°Ð½Ñ ÑÑ‡Ñ‘Ñ‚Ð°: 1000 ÐµÐ´Ð¸Ð½Ð¸Ñ†\nÐ¡Ð¾ ÑÑ‡ÐµÑ‚Ð° ÑÐ½ÑÑ‚Ð¾: 300 ÐµÐ´Ð¸Ð½Ð¸Ñ†\nÐ‘Ð°Ð»Ð°Ð½Ñ ÑÑ‡Ñ‘Ñ‚Ð°: 700 ÐµÐ´Ð¸Ð½Ð¸Ñ†"
          comparison-method: exact
          timeout: 5
          max-score: 17
      
      # Ð¢ÐµÑÑ‚ 3
      - name: Test 3 - Insufficient funds
        id: test3
        uses: classroom-resources/autograding-io-grader@v1
        with:
          test-name: "ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð²"
          command: "python test_io.py"
          input: "1000\n-1100"
          expected-output: "Ð‘Ð°Ð»Ð°Ð½Ñ ÑÑ‡Ñ‘Ñ‚Ð°: 1000 ÐµÐ´Ð¸Ð½Ð¸Ñ†\nÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð½Ð° ÑÑ‡ÐµÑ‚Ðµ\nÐ‘Ð°Ð»Ð°Ð½Ñ ÑÑ‡Ñ‘Ñ‚Ð°: 1000 ÐµÐ´Ð¸Ð½Ð¸Ñ†"
          comparison-method: exact
          timeout: 5
          max-score: 16
      
      # Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÐ¼ Summary
      - name: Generate Summary
        run: |
          echo "## ðŸ¦ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ðŸ“Š Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Ð¢ÐµÑÑ‚ | ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ | Ð¡Ñ‚Ð°Ñ‚ÑƒÑ |" >> $GITHUB_STEP_SUMMARY
          echo "|------|----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ»Ð°ÑÑÐ° | 50 | âœ… |" >> $GITHUB_STEP_SUMMARY
          echo "| ÐŸÐ¾Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ð° | 17 | âœ… |" >> $GITHUB_STEP_SUMMARY
          echo "| Ð¡Ð½ÑÑ‚Ð¸Ðµ ÑÑ€ÐµÐ´ÑÑ‚Ð² | 17 | âœ… |" >> $GITHUB_STEP_SUMMARY
          echo "| ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ ÑÑ€ÐµÐ´ÑÑ‚Ð² | 16 | âœ… |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "**Ð’ÑÐµÐ³Ð¾: 100/100 Ð±Ð°Ð»Ð»Ð¾Ð²**" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŽ‰ ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°!" >> $GITHUB_STEP_SUMMARY
